<div class="container-list">
    <material-fab raised (trigger)="selectInitiative(null);goToDetail(null)">
        <material-icon icon="add"></material-icon>
    </material-fab>
    <br/>

    <material-list class="shadow-box-material-list" elevation="2">
        <div *ngFor="let iinitiative of initiatives">
            <material-list-item (trigger)="goToWorkItem(iinitiative)">

                <div>
                    <h4 class="material-list-item-content"><strong>{{iinitiative.name}}</strong></h4>
                    <p class="material-list-item-content">{{iinitiative.description}}</p>
                </div>
                <span class="row-spacer"></span>
                <div class="material-list-item-secondary">
                    <div class="horizontal">

                        <span class="horizontal" clickableTooltipTarget
                              keyboardOnlyFocusIndicator
                              tabindex="0"
                              size="medium"
                              #clickableRef="tooltipTarget">

                            <div class="progress-state-bar" *ngFor="let istate of iinitiative.stateWorkItemsCount.keys">
                                <span [style.background-color]="'hsl(' + istate?.colorHue + ', ' + istate?.colorSaturation + '%, ' + istate?.colorLightness + '%)'" [style.width]="widthState(iinitiative?.workItemsCount, iinitiative?.stateWorkItemsCount[istate], 128) + 'px'"></span>
                            </div>
                        </span>
                        <material-tooltip-card [for]="clickableRef">
                            <div *ngFor="let istage of iinitiative.stageWorkItemsCount.keys; let iee = index">
                                <div *ngIf="iee == 0 || iinitiative.stageWorkItemsCount.keys.elementAt(iee-1).state != iinitiative.stageWorkItemsCount.keys.elementAt(iee).state">
                                    <br/>
                                    <div class="tooltip-card-bar" [style.background-color]="'hsl(' + istage.state.colorHue + ', ' + istage.state.colorSaturation + '%, ' + istage.state.colorLightness + '%)'">
                                    </div>&nbsp;<strong>{{istage.state.name}}</strong><br/>
                                </div>
                                <b>{{iinitiative?.stageWorkItemsCount[istage]}}</b>&nbsp;{{istage.name}}
                            </div>
                        </material-tooltip-card>
                        <span class="row-spacer"></span>
                        <div *ngIf="iinitiative.workItemsCount != 0" class="circle" [style.background-color]="circleColor(iinitiative)" clickableTooltipTarget
                             keyboardOnlyFocusIndicator
                             tabindex="0"
                             size="medium"
                             #clickableRefCircle="tooltipTarget">
                            <material-tooltip-card [for]="clickableRefCircle" >
                                <p><b>{{iinitiative.workItemsOverDueCount}} / {{iinitiative.workItemsCount}}</b>&nbsp;{{workItemsOverDueLabel}}</p>
                            </material-tooltip-card>
                        </div>
                        <span class="row-spacer"></span>
                        <div>
                            <material-menu [menu]="menuModel" (click)="stopPropagation($event);selectInitiative(iinitiative)">
                            </material-menu>
                        </div>
                    </div>
                </div>
            </material-list-item>
            <hr>
        </div>
    </material-list>
</div>
<router-outlet [routes]="routes"></router-outlet>
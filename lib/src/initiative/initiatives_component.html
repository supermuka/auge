<div class="container-list">
    <material-fab raised (trigger)="selectInitiative(null);viewDetail(true)">
        <material-icon icon="add"></material-icon>
    </material-fab>
    <br/>
    <material-expansionpanel-set>
        <div *ngFor="let iInitiative of initiatives">
            <material-expansionpanel
                    [alwaysHideExpandIcon]="true"
                    [hideExpandedHeader]="false"
                    [showSaveCancel]="false">
                <div name class="custom-expansionpanel-panel-specific-name-width">
                    <span class="truncate-ellipsed-parent">
                        <div class="truncate-ellipsed">{{iInitiative.name}}</div>
                        <div class="truncate-ellipsed">{{iInitiative.description}}</div>
                    </span>
                </div>
                <div value>
                    <span class="progress-bar w3-col s6 l10" clickableTooltipTarget
                          keyboardOnlyFocusIndicator
                          tabindex="0"
                          size="medium"
                          #clickableRef="tooltipTarget">
                        <span *ngFor="let istate of iInitiative.stateWorkItemsCount.keys">
                            <span [style.background-color]="'hsl(' + istate?.colorHue + ', ' + istate?.colorSaturation + '%, ' + istate?.colorLightness + '%)'" [style.width]="widthState(iInitiative?.workItemsCount, iInitiative?.stateWorkItemsCount[istate], progressBarWidth) + 'px'">&nbsp;</span>
                        </span>

                        <material-tooltip-card [for]="clickableRef">
                            <div *ngFor="let istage of iInitiative.stageWorkItemsCount.keys; let iee = index">
                                <div *ngIf="iee == 0 || iInitiative.stageWorkItemsCount.keys.elementAt(iee-1).state != iInitiative.stageWorkItemsCount.keys.elementAt(iee).state">
                                    <br/>
                                    <div class="tooltip-card-bar" [style.background-color]="'hsl(' + istage.state.colorHue + ', ' + istage.state.colorSaturation + '%, ' + istage.state.colorLightness + '%)'">
                                    </div>&nbsp;<strong>{{istage.state.name}}</strong><br/>
                                </div>
                                <b>{{iInitiative?.stageWorkItemsCount[istage]}}</b>&nbsp;{{istage.name}}
                            </div>
                        </material-tooltip-card>
                    </span>
                    <span *ngIf="iInitiative.workItemsCount != 0" class="circle w3-col s6 l2" [style.background-color]="circleColor(iInitiative)" clickableTooltipTarget
                         keyboardOnlyFocusIndicator
                         tabindex="0"
                         size="medium"
                         #clickableRefCircle="tooltipTarget">
                        <material-tooltip-card [for]="clickableRefCircle" >
                            <p><b>{{iInitiative.workItemsOverDueCount}} / {{iInitiative.workItemsCount}}</b>&nbsp;{{workItemsOverDueLabel}}</p>
                        </material-tooltip-card>
                    </span>
                </div>
                <div action>
                    <material-menu [menu]="menuModel" (click)="selectInitiative(iInitiative)">
                    </material-menu>
                </div>
                <auge-work-items [initiative]="iInitiative"></auge-work-items>
            </material-expansionpanel>
        </div>
    </material-expansionpanel-set>
    <auge-initiative-detail *ngIf="detailVisible == true" [selectedInitiative]="selectedInitiative" (save)="changeListItemWithDetail($event)" (close)="viewDetail(false)">
    </auge-initiative-detail>
</div>